<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<title>
 RGB images and memory layouts part 2
</title>
<link rel="stylesheet" type="text/css" href="../assets/css/highlight.css">
<style>

a:visited {
color: #000000;
}

a:link {
color: #000000;
}

a:hover {
color: #aa0000;
}

</style>
</head>
<body class="hl" style="background-color: #444444; font-family: Helvetica, Arial, sans-serif;">
<script>
function toggle(id) {
    e = document.getElementById(id);
    show = document.getElementById(id + '-show');
    if (e.style.display != 'none') {
        e.style.display = 'none';
        show.innerHTML = "// Click to show output ...";
    } else {
        e.style.display = 'block';
        show.innerHTML = "// Click to hide output ...";
    }
    return false;
}
</script>
<div>
<style scoped>
@import "../assets/css/bootstrap.css";
</style>
<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
      <a class="brand" href="/index.html">Halide</a>
      <div class="nav-collapse">
        <ul class="nav">
          <li><a href="/index.html#gettingstarted">Getting Started</a></li>
          <li><a href="/tutorials/tutorial_introduction.html">Tutorials</a></li>
          <li><a href="/index.html#publications">Publications</a></li>
          <li><a href="/index.html#resources">Resources</a></li>
          <li class="divider-vertical"></li>
          <li><a href="/docs">Docs</a></li>
          <li><a href="http://github.com/halide/Halide/issues">Bugs</a></li>
          <li><a href="http://github.com/halide/Halide/wiki">Wiki</a></li>
          <li class="divider-vertical"></li>
          <li><a href="http://stackoverflow.com/questions/tagged/halide"><i class="fa fa-stack-overflow"></i>/#halide</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>
</div>

<div style='position:relative; width:900pt; top:60px;'>
<div style="width:200px; float:left; ">
<a href="tutorial_introduction.html" style="text-decoration:none;" ><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px;
background-color: #dddddd; 
text-align: left; ">
<b>
00
&nbsp</b>
Introduction
</div>
</span>
</a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_01_basics.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
01
&nbsp</b>
 Getting started with Funcs, Vars, and Exprs
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_02_input_image.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
02
&nbsp</b>
 Processing images
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_03_debugging_1.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
03
&nbsp</b>
 Inspecting the generated code
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_04_debugging_2.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
04
&nbsp</b>
 Debugging with tracing, print, and print_when
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_05_scheduling_1.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
05
&nbsp</b>
 Vectorize, parallelize, unroll and tile your code
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_06_realizing_over_shifted_domains.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
06
&nbsp</b>
 Realizing Funcs over arbitrary domains
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_07_multi_stage_pipelines.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
07
&nbsp</b>
 Multi-stage pipelines
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_08_scheduling_2.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
08
&nbsp</b>
 Scheduling multi-stage pipelines
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_09_update_definitions.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
09
&nbsp</b>
 Multi-pass Funcs, update definitions, and reductions
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_10_aot_compilation_generate.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
10
&nbsp</b>
 AOT compilation part 1
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_10_aot_compilation_run.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
10
&nbsp</b>
 AOT compilation part 2
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_11_cross_compilation.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
11
&nbsp</b>
 Cross-compilation
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_12_using_the_gpu.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
12
&nbsp</b>
 Using the GPU
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_13_tuples.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
13
&nbsp</b>
 Tuples
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_14_types.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
14
&nbsp</b>
 The Halide type system
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_15_generators.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
15
&nbsp</b>
 Generators part 1
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_16_rgb_generate.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
16
&nbsp</b>
 RGB images and memory layouts part 1
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_16_rgb_run.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; padding-right:40px; background-color: #ffffff; color: #000000; text-align: left; ">
<b>
16
&nbsp</b>
 RGB images and memory layouts part 2
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_15_generators_usage.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #dddddd; text-align: left; ">
<b>
15
&nbsp</b>
 Generators part 2
</div></span></a>
</div>
<div style="position:relative; margin-left:260px; padding:20px; background-color: #ffffff;">
<pre class="hl">
<span class="hl slc">// Halide tutorial lesson 16: RGB images and memory layouts part 2</span>

<span class="hl slc">// Before reading this file, see lesson_16_rgb_generate.cpp</span>

<span class="hl slc">// This is the code that actually uses the Halide pipeline we've</span>
<span class="hl slc">// compiled. It does not depend on libHalide, so we won't be including</span>
<span class="hl slc">// Halide.h.</span>
<span class="hl slc">//</span>
<span class="hl slc">// Instead, it depends on the header files that lesson_16_rgb_generator produced.</span>
<span class="hl ppc">#include</span> <span class="hl pps">&quot;brighten_planar.h&quot;</span><span class="hl ppc"></span>
<span class="hl ppc">#include</span> <span class="hl pps">&quot;brighten_interleaved.h&quot;</span><span class="hl ppc"></span>
<span class="hl ppc">#include</span> <span class="hl pps">&quot;brighten_either.h&quot;</span><span class="hl ppc"></span>
<span class="hl ppc">#include</span> <span class="hl pps">&quot;brighten_specialized.h&quot;</span><span class="hl ppc"></span>

<span class="hl ppc">#include &lt;stdio.h&gt;</span>
<span class="hl ppc">#include &lt;stdlib.h&gt;</span>
<span class="hl ppc">#include &lt;string.h&gt;</span>
<span class="hl ppc">#include &lt;assert.h&gt;</span>

<span class="hl ppc">#include</span> <span class="hl pps">&quot;clock.h&quot;</span><span class="hl ppc"></span>

buffer_t <span class="hl kwd">make_planar_rgb_image</span><span class="hl opt">(</span><span class="hl kwb">int</span> width<span class="hl opt">,</span> <span class="hl kwb">int</span> height<span class="hl opt">) {</span>
    buffer_t buf <span class="hl opt">= {</span><span class="hl num">0</span><span class="hl opt">};</span>
    <span class="hl slc">// Allocate the memory required and clear it</span>
    buf<span class="hl opt">.</span>host <span class="hl opt">= (</span><span class="hl kwb">uint8_t</span> <span class="hl opt">*)</span><span class="hl kwd">malloc</span><span class="hl opt">(</span>width <span class="hl opt">*</span> height <span class="hl opt">*</span> <span class="hl num">3</span><span class="hl opt">);</span>
    <span class="hl kwd">memset</span><span class="hl opt">(</span>buf<span class="hl opt">.</span>host<span class="hl opt">,</span> <span class="hl num">0</span><span class="hl opt">,</span> width <span class="hl opt">*</span> height <span class="hl opt">*</span> <span class="hl num">3</span><span class="hl opt">);</span>
    <span class="hl slc">// This will be an 8-bit image.</span>
    buf<span class="hl opt">.</span>elem_size <span class="hl opt">=</span> <span class="hl num">1</span><span class="hl opt">;</span>

    <span class="hl slc">// Set the sizes of each dimension</span>
    buf<span class="hl opt">.</span>extent<span class="hl opt">[</span><span class="hl num">0</span><span class="hl opt">] =</span> width<span class="hl opt">;</span>
    buf<span class="hl opt">.</span>extent<span class="hl opt">[</span><span class="hl num">1</span><span class="hl opt">] =</span> height<span class="hl opt">;</span>
    <span class="hl slc">// There are three color channels</span>
    buf<span class="hl opt">.</span>extent<span class="hl opt">[</span><span class="hl num">2</span><span class="hl opt">] =</span> <span class="hl num">3</span><span class="hl opt">;</span>

    <span class="hl slc">// Planar layout means that the stride in x is 1</span>
    buf<span class="hl opt">.</span>stride<span class="hl opt">[</span><span class="hl num">0</span><span class="hl opt">] =</span> <span class="hl num">1</span><span class="hl opt">;</span>
    <span class="hl slc">// The stride in y is the width of the image</span>
    buf<span class="hl opt">.</span>stride<span class="hl opt">[</span><span class="hl num">1</span><span class="hl opt">] =</span> width<span class="hl opt">;</span>
    <span class="hl slc">// And the stride in c is width times height. This means that to</span>
    <span class="hl slc">// get to the next color channel, one should step forwards</span>
    <span class="hl slc">// width*height elements in memory.</span>
    buf<span class="hl opt">.</span>stride<span class="hl opt">[</span><span class="hl num">2</span><span class="hl opt">] =</span> width<span class="hl opt">*</span>height<span class="hl opt">;</span>

    <span class="hl kwa">return</span> buf<span class="hl opt">;</span>
<span class="hl opt">}</span>

buffer_t <span class="hl kwd">make_interleaved_rgb_image</span><span class="hl opt">(</span><span class="hl kwb">int</span> width<span class="hl opt">,</span> <span class="hl kwb">int</span> height<span class="hl opt">) {</span>
    buffer_t buf <span class="hl opt">= {</span><span class="hl num">0</span><span class="hl opt">};</span>
    <span class="hl slc">// This code will be the same as making a planar rgb image ...</span>
    buf<span class="hl opt">.</span>host <span class="hl opt">= (</span><span class="hl kwb">uint8_t</span> <span class="hl opt">*)</span><span class="hl kwd">malloc</span><span class="hl opt">(</span>width <span class="hl opt">*</span> height <span class="hl opt">*</span> <span class="hl num">3</span><span class="hl opt">);</span>
    <span class="hl kwd">memset</span><span class="hl opt">(</span>buf<span class="hl opt">.</span>host<span class="hl opt">,</span> <span class="hl num">0</span><span class="hl opt">,</span> width <span class="hl opt">*</span> height <span class="hl opt">*</span> <span class="hl num">3</span><span class="hl opt">);</span>
    buf<span class="hl opt">.</span>elem_size <span class="hl opt">=</span> <span class="hl num">1</span><span class="hl opt">;</span>
    buf<span class="hl opt">.</span>extent<span class="hl opt">[</span><span class="hl num">0</span><span class="hl opt">] =</span> width<span class="hl opt">;</span>
    buf<span class="hl opt">.</span>extent<span class="hl opt">[</span><span class="hl num">1</span><span class="hl opt">] =</span> height<span class="hl opt">;</span>
    buf<span class="hl opt">.</span>extent<span class="hl opt">[</span><span class="hl num">2</span><span class="hl opt">] =</span> <span class="hl num">3</span><span class="hl opt">;</span>

    <span class="hl slc">// ... except we'll set up the strides differently.</span>
    <span class="hl slc">// Interleaved layout means that the stride in x is 3</span>
    buf<span class="hl opt">.</span>stride<span class="hl opt">[</span><span class="hl num">0</span><span class="hl opt">] =</span> <span class="hl num">3</span><span class="hl opt">;</span>
    <span class="hl slc">// The stride in y is three times the width of the image</span>
    buf<span class="hl opt">.</span>stride<span class="hl opt">[</span><span class="hl num">1</span><span class="hl opt">] =</span> <span class="hl num">3</span><span class="hl opt">*</span>width<span class="hl opt">;</span>
    <span class="hl slc">// And the stride in c is 1.</span>
    buf<span class="hl opt">.</span>stride<span class="hl opt">[</span><span class="hl num">2</span><span class="hl opt">] =</span> <span class="hl num">1</span><span class="hl opt">;</span>

    <span class="hl kwa">return</span> buf<span class="hl opt">;</span>
<span class="hl opt">}</span>

<span class="hl kwb">void</span> <span class="hl kwd">destroy_image</span><span class="hl opt">(</span>buffer_t <span class="hl opt">*</span>b<span class="hl opt">) {</span>
    <span class="hl kwd">free</span><span class="hl opt">(</span>b<span class="hl opt">-&gt;</span>host<span class="hl opt">);</span>
    b<span class="hl opt">-&gt;</span>host <span class="hl opt">=</span> NULL<span class="hl opt">;</span>
<span class="hl opt">}</span>

<span class="hl slc">// A function to help us report runtimes of various things. Prints the</span>
<span class="hl slc">// time elapsed since the last time you called this function.</span>
<span class="hl kwb">double</span> <span class="hl kwd">tick</span><span class="hl opt">(</span><span class="hl kwb">const char</span> <span class="hl opt">*</span>name<span class="hl opt">) {</span>
    <span class="hl kwb">static double</span> t_old <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span>
    <span class="hl kwb">double</span> t_new <span class="hl opt">=</span> <span class="hl kwd">current_time</span><span class="hl opt">();</span>
    <span class="hl kwb">double</span> dt <span class="hl opt">=</span> t_new <span class="hl opt">-</span> t_old<span class="hl opt">;</span>
    <span class="hl kwa">if</span> <span class="hl opt">(</span>name<span class="hl opt">) {</span>
        <span class="hl kwd">printf</span><span class="hl opt">(</span><span class="hl str">&quot;%s: %f</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">,</span> name<span class="hl opt">,</span> dt<span class="hl opt">);</span>
    <span class="hl opt">}</span>
    t_old <span class="hl opt">=</span> t_new<span class="hl opt">;</span>
    <span class="hl kwa">return</span> dt<span class="hl opt">;</span>
<span class="hl opt">}</span>

<span class="hl kwb">int</span> <span class="hl kwd">main</span><span class="hl opt">(</span><span class="hl kwb">int</span> argc<span class="hl opt">,</span> <span class="hl kwb">char</span> <span class="hl opt">**</span>argv<span class="hl opt">) {</span>
    <span class="hl slc">// Let's make some images stored with interleaved and planar</span>
    <span class="hl slc">// memory, and buffer_ts that describe them.</span>
    buffer_t planar_input <span class="hl opt">=</span> <span class="hl kwd">make_planar_rgb_image</span><span class="hl opt">(</span><span class="hl num">1024</span><span class="hl opt">,</span> <span class="hl num">768</span><span class="hl opt">);</span>
    buffer_t planar_output <span class="hl opt">=</span> <span class="hl kwd">make_planar_rgb_image</span><span class="hl opt">(</span><span class="hl num">1024</span><span class="hl opt">,</span> <span class="hl num">768</span><span class="hl opt">);</span>
    buffer_t interleaved_input <span class="hl opt">=</span> <span class="hl kwd">make_interleaved_rgb_image</span><span class="hl opt">(</span><span class="hl num">1024</span><span class="hl opt">,</span> <span class="hl num">768</span><span class="hl opt">);</span>
    buffer_t interleaved_output <span class="hl opt">=</span> <span class="hl kwd">make_interleaved_rgb_image</span><span class="hl opt">(</span><span class="hl num">1024</span><span class="hl opt">,</span> <span class="hl num">768</span><span class="hl opt">);</span>

    <span class="hl slc">// We'll now call the various functions we compiled and check the</span>
    <span class="hl slc">// performance of each.</span>
    <span class="hl kwb">uint8_t</span> offset <span class="hl opt">=</span> <span class="hl num">1</span><span class="hl opt">;</span>

    <span class="hl slc">// Start the clock</span>
    <span class="hl kwd">tick</span><span class="hl opt">(</span>NULL<span class="hl opt">);</span>

    <span class="hl slc">// Run the planar version of the code on the planar images and the</span>
    <span class="hl slc">// interleaved version of the code on the interleaved</span>
    <span class="hl slc">// images. We'll run each 100 times for benchmarking.</span>
    <span class="hl kwa">for</span> <span class="hl opt">(</span><span class="hl kwb">int</span> i <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span> <span class="hl num">100</span><span class="hl opt">;</span> i<span class="hl opt">++) {</span>
        <span class="hl kwd">brighten_planar</span><span class="hl opt">(&amp;</span>planar_input<span class="hl opt">,</span> <span class="hl num">1</span><span class="hl opt">, &amp;</span>planar_output<span class="hl opt">);</span>
    <span class="hl opt">}</span>
    <span class="hl kwb">double</span> planar_time <span class="hl opt">=</span> <span class="hl kwd">tick</span><span class="hl opt">(</span><span class="hl str">&quot;brighten_planar&quot;</span><span class="hl opt">);</span>
    <a onclick='return toggle("_108");'><b id=_108-show>// Click to show output ...</b></a><div id=_108 style= "display:none; background:#333333; color:#ffffff"><b>
 > brighten_planar: 41.740000

</b></div>

    <span class="hl kwa">for</span> <span class="hl opt">(</span><span class="hl kwb">int</span> i <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span> <span class="hl num">100</span><span class="hl opt">;</span> i<span class="hl opt">++) {</span>
        <span class="hl kwd">brighten_interleaved</span><span class="hl opt">(&amp;</span>interleaved_input<span class="hl opt">,</span> <span class="hl num">1</span><span class="hl opt">, &amp;</span>interleaved_output<span class="hl opt">);</span>
    <span class="hl opt">}</span>
    <span class="hl kwb">double</span> interleaved_time <span class="hl opt">=</span> <span class="hl kwd">tick</span><span class="hl opt">(</span><span class="hl str">&quot;brighten_interleaved&quot;</span><span class="hl opt">);</span>
    <a onclick='return toggle("_113");'><b id=_113-show>// Click to show output ...</b></a><div id=_113 style= "display:none; background:#333333; color:#ffffff"><b>
 > brighten_interleaved: 65.569000

</b></div>

    <span class="hl slc">// Planar is generally faster than interleaved for most imaging</span>
    <span class="hl slc">// operations.</span>
    <span class="hl kwa">assert</span><span class="hl opt">(</span>planar_time <span class="hl opt">&lt;</span> interleaved_time<span class="hl opt">);</span>

    <span class="hl slc">// Either of these next two commented-out calls would throw an</span>
    <span class="hl slc">// error, because the stride is not what we promised it would be</span>
    <span class="hl slc">// in the generator.</span>

    <span class="hl slc">// brighten_planar(&amp;interleaved_input, 1, &amp;interleaved_output);</span>
    <span class="hl slc">// Error: Constraint violated: brighter.stride.0 (3) == 1 (1)</span>

    <span class="hl slc">// brighten_interleaved(&amp;planar_input, 1, &amp;planar_output);</span>
    <span class="hl slc">// Error: Constraint violated: brighter.stride.0 (1) == 3 (3)</span>

    <span class="hl slc">// Run the flexible version of the code and check performance. It</span>
    <span class="hl slc">// should work, but it'll be slower than the versions above.</span>
    <span class="hl kwa">for</span> <span class="hl opt">(</span><span class="hl kwb">int</span> i <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span> <span class="hl num">100</span><span class="hl opt">;</span> i<span class="hl opt">++) {</span>
        <span class="hl kwd">brighten_either</span><span class="hl opt">(&amp;</span>planar_input<span class="hl opt">,</span> <span class="hl num">1</span><span class="hl opt">, &amp;</span>planar_output<span class="hl opt">);</span>
    <span class="hl opt">}</span>
    <span class="hl kwb">double</span> either_planar_time <span class="hl opt">=</span> <span class="hl kwd">tick</span><span class="hl opt">(</span><span class="hl str">&quot;brighten_either on planar images&quot;</span><span class="hl opt">);</span>
    <span class="hl kwa">assert</span><span class="hl opt">(</span>planar_time <span class="hl opt">&lt;</span> either_planar_time<span class="hl opt">);</span>
    <a onclick='return toggle("_134");'><b id=_134-show>// Click to show output ...</b></a><div id=_134 style= "display:none; background:#333333; color:#ffffff"><b>
 > brighten_either on planar images: 169.257000

</b></div>

    <span class="hl kwa">for</span> <span class="hl opt">(</span><span class="hl kwb">int</span> i <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span> <span class="hl num">100</span><span class="hl opt">;</span> i<span class="hl opt">++) {</span>
        <span class="hl kwd">brighten_either</span><span class="hl opt">(&amp;</span>interleaved_input<span class="hl opt">,</span> <span class="hl num">1</span><span class="hl opt">, &amp;</span>interleaved_output<span class="hl opt">);</span>
    <span class="hl opt">}</span>
    <span class="hl kwb">double</span> either_interleaved_time <span class="hl opt">=</span> <span class="hl kwd">tick</span><span class="hl opt">(</span><span class="hl str">&quot;brighten_either on interleaved images&quot;</span><span class="hl opt">);</span>
    <span class="hl kwa">assert</span><span class="hl opt">(</span>interleaved_time <span class="hl opt">&lt;</span> either_interleaved_time<span class="hl opt">);</span>
    <a onclick='return toggle("_140");'><b id=_140-show>// Click to show output ...</b></a><div id=_140 style= "display:none; background:#333333; color:#ffffff"><b>
 > brighten_either on interleaved images: 181.984000

</b></div>

    <span class="hl slc">// Run the specialized version of the code on each layout. It</span>
    <span class="hl slc">// should match the performance of the code compiled specifically</span>
    <span class="hl slc">// for each case above by branching internally to equivalent</span>
    <span class="hl slc">// code.</span>
    <span class="hl kwa">for</span> <span class="hl opt">(</span><span class="hl kwb">int</span> i <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span> <span class="hl num">100</span><span class="hl opt">;</span> i<span class="hl opt">++) {</span>
        <span class="hl kwd">brighten_specialized</span><span class="hl opt">(&amp;</span>planar_input<span class="hl opt">,</span> <span class="hl num">1</span><span class="hl opt">, &amp;</span>planar_output<span class="hl opt">);</span>
    <span class="hl opt">}</span>
    <span class="hl kwb">double</span> specialized_planar_time <span class="hl opt">=</span> <span class="hl kwd">tick</span><span class="hl opt">(</span><span class="hl str">&quot;brighten_specialized on planar images&quot;</span><span class="hl opt">);</span>
    <a onclick='return toggle("_150");'><b id=_150-show>// Click to show output ...</b></a><div id=_150 style= "display:none; background:#333333; color:#ffffff"><b>
 > brighten_specialized on planar images: 29.873000

</b></div>

    <span class="hl slc">// The cost of the if statement should be negligible, but we'll</span>
    <span class="hl slc">// allow a tolerance of 20% for this test to account for</span>
    <span class="hl slc">// measurement noise.</span>
    <span class="hl kwa">assert</span><span class="hl opt">(</span>specialized_planar_time <span class="hl opt">&lt;</span> <span class="hl num">1.2</span> <span class="hl opt">*</span> planar_time<span class="hl opt">);</span>

    <span class="hl kwa">for</span> <span class="hl opt">(</span><span class="hl kwb">int</span> i <span class="hl opt">=</span> <span class="hl num">0</span><span class="hl opt">;</span> i <span class="hl opt">&lt;</span> <span class="hl num">100</span><span class="hl opt">;</span> i<span class="hl opt">++) {</span>
        <span class="hl kwd">brighten_specialized</span><span class="hl opt">(&amp;</span>interleaved_input<span class="hl opt">,</span> <span class="hl num">1</span><span class="hl opt">, &amp;</span>interleaved_output<span class="hl opt">);</span>
    <span class="hl opt">}</span>
    <span class="hl kwb">double</span> specialized_interleaved_time <span class="hl opt">=</span> <span class="hl kwd">tick</span><span class="hl opt">(</span><span class="hl str">&quot;brighten_specialized on interleaved images&quot;</span><span class="hl opt">);</span>
    <span class="hl kwa">assert</span><span class="hl opt">(</span>specialized_interleaved_time <span class="hl opt">&lt;</span> <span class="hl num">1.2</span> <span class="hl opt">*</span> interleaved_time<span class="hl opt">);</span>
    <a onclick='return toggle("_160");'><b id=_160-show>// Click to show output ...</b></a><div id=_160 style= "display:none; background:#333333; color:#ffffff"><b>
 > brighten_specialized on interleaved images: 67.370000

</b></div>

    <span class="hl slc">// Remember to free our allocated memory...</span>
    <span class="hl kwd">destroy_image</span><span class="hl opt">(&amp;</span>planar_input<span class="hl opt">);</span>
    <span class="hl kwd">destroy_image</span><span class="hl opt">(&amp;</span>planar_output<span class="hl opt">);</span>
    <span class="hl kwd">destroy_image</span><span class="hl opt">(&amp;</span>interleaved_input<span class="hl opt">);</span>
    <span class="hl kwd">destroy_image</span><span class="hl opt">(&amp;</span>interleaved_output<span class="hl opt">);</span>
    <span class="hl kwa">return</span> <span class="hl num">0</span><span class="hl opt">;</span>
<span class="hl opt">}</span>
</pre>
</div></body></html>
