<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<title>
lesson 11 cross compilation
</title>
<link rel="stylesheet" type="text/css" href="highlight.css">
<style>

a:visited {
color: #000000;
}

a:link {
color: #000000;
}

a:hover {
color: #aa0000;
}

</style>
</head>
<body class="hl" style="background-color: #dddddd; font-family: Helvetica, Arial, sans-serif;">

<div>
<style scoped>
@import "../assets/css/bootstrap.css";
</style>
<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
      <a class="brand" href="#">Halide</a>
      <div class="nav-collapse">
        <ul class="nav">
          <li class="active"><a href="index.html#overview">Overview</a></li>
          <li><a href="index.html#gettingstarted">Getting Started</a></li>
          <li><a href="index.html#publications">Publications</a></li>
          <li><a href="index.html#resources">Resources</a></li>
          <li class="divider-vertical"></li>
          <li><a href="/docs">Docs</a></li>
          <li><a href="http://github.com/halide/Halide/issues">Bugs</a></li>
          <li><a href="http://github.com/halide/Halide/wiki">Wiki</a></li>
          <li class="divider-vertical"></li>
          <li><a href="http://stackoverflow.com/questions/tagged/halide"><i class="fa fa-stack-overflow"></i>/#halide</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>
</div>

<div style="position:relative; width: 100%">
<div style="width:200px; float:left; ">
<a href="tutorial_introduction.html" style="text-decoration:none;" ><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px;
background-color: #ffffff; text-align: left; ">
<b>
00
&nbsp</b>
Introduction
</div>
</span>
</a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_01_basics.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #ffffff; text-align: left; ">
<b>
01
&nbsp</b>
 Getting started with Funcs, Vars, and Exprs
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_02_input_image.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #ffffff; text-align: left; ">
<b>
02
&nbsp</b>
 Processing images
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_03_debugging_1.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #ffffff; text-align: left; ">
<b>
03
&nbsp</b>
 Inspecting the generated code
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_04_debugging_2.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #ffffff; text-align: left; ">
<b>
04
&nbsp</b>
 Debugging with tracing, print, and print_when
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_05_scheduling_1.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #ffffff; text-align: left; ">
<b>
05
&nbsp</b>
 Vectorize, parallelize, unroll and tile your code
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_06_realizing_over_shifted_domains.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #ffffff; text-align: left; ">
<b>
06
&nbsp</b>
 Realizing Funcs over arbitrary domains
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_07_multi_stage_pipelines.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #ffffff; text-align: left; ">
<b>
07
&nbsp</b>
 Multi-stage pipelines
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_08_scheduling_2.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #ffffff; text-align: left; ">
<b>
08
&nbsp</b>
 Scheduling multi-stage pipelines
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_09_update_definitions.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #ffffff; text-align: left; ">
<b>
09
&nbsp</b>
 Multi-pass Funcs, update definitions, and reductions
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_10_aot_compilation_generate.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #ffffff; text-align: left; ">
<b>
10
&nbsp</b>
 AOT compilation part 1
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_10_aot_compilation_run.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #ffffff; text-align: left; ">
<b>
10
&nbsp</b>
 AOT compilation part 2
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_11_cross_compilation.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; padding-right:40px; background-color: #ffffff; color: #aa0000; text-align: left; ">
<b>
11
&nbsp</b>
 Cross-compilation
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_12_using_the_gpu.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #ffffff; text-align: left; ">
<b>
12
&nbsp</b>
 Using the GPU
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_13_tuples.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #ffffff; text-align: left; ">
<b>
13
&nbsp</b>
 Tuples
</div></span></a>
<div style="width:200px; height:20px;"></div>
<a href=
tutorial_lesson_14_types.html
 style="text-decoration:none;"><span style="width:100%; height:100%; top:0; left:0;">
<div style="width:200px; padding:20px; background-color: #ffffff; text-align: left; ">
<b>
14
&nbsp</b>
 The Halide type system
</div></span></a>
</div>
<div style="position:relative; margin-left:260px; padding:20px; background-color: #ffffff;">
<pre class="hl">
<span class="hl slc">// Halide tutorial lesson 11: Cross-compilation</span>

<span class="hl slc">// This lesson demonstrates how to use Halide as a cross-compiler to</span>
<span class="hl slc">// generate code for any platform from any platform.</span>

<span class="hl slc">// On linux, you can compile and run it like so:</span>
<span class="hl slc">// g++ lesson_11*.cpp -g -std=c++11 -I ../include -L ../bin -lHalide -lpthread -ldl -o lesson_11</span>
<span class="hl slc">// LD_LIBRARY_PATH=../bin ./lesson_11</span>

<span class="hl slc">// On os x:</span>
<span class="hl slc">// g++ lesson_11*.cpp -g -std=c++11 -I ../include -L ../bin -lHalide -o lesson_11</span>
<span class="hl slc">// DYLD_LIBRARY_PATH=../bin ./lesson_11</span>

<span class="hl slc">// If you have the entire Halide source tree, you can also build it by</span>
<span class="hl slc">// running:</span>
<span class="hl slc">//    make tutorial_lesson_11_cross_compilation</span>
<span class="hl slc">// in a shell with the current directory at the top of the halide</span>
<span class="hl slc">// source tree.</span>

<span class="hl ppc">#include</span> <span class="hl pps">&quot;Halide.h&quot;</span><span class="hl ppc"></span>
<span class="hl ppc">#include &lt;stdio.h&gt;</span>
<span class="hl kwa">using namespace</span> Halide<span class="hl opt">;</span>

<span class="hl kwb">int</span> <span class="hl kwd">main</span><span class="hl opt">(</span><span class="hl kwb">int</span> argc<span class="hl opt">,</span> <span class="hl kwb">char</span> <span class="hl opt">**</span>argv<span class="hl opt">) {</span>

    <span class="hl slc">// We'll define the simple one-stage pipeline that we used in lesson 10.</span>
    Func brighter<span class="hl opt">;</span>
    Var x<span class="hl opt">,</span> y<span class="hl opt">;</span>

    <span class="hl slc">// Declare the arguments.</span>
    Param<span class="hl opt">&lt;</span><span class="hl kwb">uint8_t</span><span class="hl opt">&gt;</span> offset<span class="hl opt">;</span>
    ImageParam <span class="hl kwd">input</span><span class="hl opt">(</span>type_of<span class="hl opt">&lt;</span><span class="hl kwb">uint8_t</span><span class="hl opt">&gt;(),</span> <span class="hl num">2</span><span class="hl opt">);</span>
    std<span class="hl opt">::</span>vector<span class="hl opt">&lt;</span>Argument<span class="hl opt">&gt;</span> <span class="hl kwd">args</span><span class="hl opt">(</span><span class="hl num">2</span><span class="hl opt">);</span>
    args<span class="hl opt">[</span><span class="hl num">0</span><span class="hl opt">] =</span> input<span class="hl opt">;</span>
    args<span class="hl opt">[</span><span class="hl num">1</span><span class="hl opt">] =</span> offset<span class="hl opt">;</span>

    <span class="hl slc">// Define the Func.</span>
    <span class="hl kwd">brighter</span><span class="hl opt">(</span>x<span class="hl opt">,</span> y<span class="hl opt">) =</span> <span class="hl kwd">input</span><span class="hl opt">(</span>x<span class="hl opt">,</span> y<span class="hl opt">) +</span> offset<span class="hl opt">;</span>

    <span class="hl slc">// Schedule it.</span>
    brighter<span class="hl opt">.</span><span class="hl kwd">vectorize</span><span class="hl opt">(</span>x<span class="hl opt">,</span> <span class="hl num">16</span><span class="hl opt">).</span><span class="hl kwd">parallel</span><span class="hl opt">(</span>y<span class="hl opt">);</span>

    <span class="hl slc">// The following line is what we did in lesson 10. It compiles an</span>
    <span class="hl slc">// object file suitable for the system that you're running this</span>
    <span class="hl slc">// program on.  For example, if you compile and run this file on</span>
    <span class="hl slc">// 64-bit linux on an x86 cpu with sse4.1, then the generated code</span>
    <span class="hl slc">// will be suitable for 64-bit linux on x86 with sse4.1.</span>
    brighter<span class="hl opt">.</span><span class="hl kwd">compile_to_file</span><span class="hl opt">(</span><span class="hl str">&quot;lesson_11_host&quot;</span><span class="hl opt">,</span> args<span class="hl opt">);</span>

    <span class="hl slc">// We can also compile object files suitable for other cpus and</span>
    <span class="hl slc">// operating systems. You do this with an optional third argument</span>
    <span class="hl slc">// to compile_to_file which specifies the target to compile for.</span>

    <span class="hl slc">// Let's use this to compile a 32-bit arm android version of this code:</span>
    Target target<span class="hl opt">;</span>
    target<span class="hl opt">.</span>os <span class="hl opt">=</span> Target<span class="hl opt">::</span>Android<span class="hl opt">;</span> <span class="hl slc">// The operating system</span>
    target<span class="hl opt">.</span>arch <span class="hl opt">=</span> Target<span class="hl opt">::</span>ARM<span class="hl opt">;</span>   <span class="hl slc">// The CPU architecture</span>
    target<span class="hl opt">.</span>bits <span class="hl opt">=</span> <span class="hl num">32</span><span class="hl opt">;</span>            <span class="hl slc">// The bit-width of the architecture</span>
    std<span class="hl opt">::</span>vector<span class="hl opt">&lt;</span>Target<span class="hl opt">::</span>Feature<span class="hl opt">&gt;</span> arm_features<span class="hl opt">;</span> <span class="hl slc">// A list of features to set</span>
    target<span class="hl opt">.</span><span class="hl kwd">set_features</span><span class="hl opt">(</span>arm_features<span class="hl opt">);</span>
    brighter<span class="hl opt">.</span><span class="hl kwd">compile_to_file</span><span class="hl opt">(</span><span class="hl str">&quot;lesson_11_arm_32_android&quot;</span><span class="hl opt">,</span> args<span class="hl opt">,</span> target<span class="hl opt">);</span> <span class="hl slc">// Pass the target as the last argument.</span>

    <span class="hl slc">// And now a Windows object file for 64-bit x86 with AVX and SSE 4.1:</span>
    target<span class="hl opt">.</span>os <span class="hl opt">=</span> Target<span class="hl opt">::</span>Windows<span class="hl opt">;</span>
    target<span class="hl opt">.</span>arch <span class="hl opt">=</span> Target<span class="hl opt">::</span>X86<span class="hl opt">;</span>
    target<span class="hl opt">.</span>bits <span class="hl opt">=</span> <span class="hl num">64</span><span class="hl opt">;</span>
    std<span class="hl opt">::</span>vector<span class="hl opt">&lt;</span>Target<span class="hl opt">::</span>Feature<span class="hl opt">&gt;</span> x86_features<span class="hl opt">;</span>
    x86_features<span class="hl opt">.</span><span class="hl kwd">push_back</span><span class="hl opt">(</span>Target<span class="hl opt">::</span>AVX<span class="hl opt">);</span>
    x86_features<span class="hl opt">.</span><span class="hl kwd">push_back</span><span class="hl opt">(</span>Target<span class="hl opt">::</span>SSE41<span class="hl opt">);</span>
    target<span class="hl opt">.</span><span class="hl kwd">set_features</span><span class="hl opt">(</span>x86_features<span class="hl opt">);</span>
    brighter<span class="hl opt">.</span><span class="hl kwd">compile_to_file</span><span class="hl opt">(</span><span class="hl str">&quot;lesson_11_x86_64_windows&quot;</span><span class="hl opt">,</span> args<span class="hl opt">,</span> target<span class="hl opt">);</span>

    <span class="hl slc">// And finally an iOS mach-o object file for one of Apple's 32-bit</span>
    <span class="hl slc">// ARM processors - the A6. It's used in the iPhone 5. The A6 uses</span>
    <span class="hl slc">// a slightly modified ARM architecture called ARMv7s. We specify</span>
    <span class="hl slc">// this using the target features field.  Support for Apple's</span>
    <span class="hl slc">// 64-bit ARM processors is very new in llvm, and still somewhat</span>
    <span class="hl slc">// flaky.</span>
    target<span class="hl opt">.</span>os <span class="hl opt">=</span> Target<span class="hl opt">::</span>IOS<span class="hl opt">;</span>
    target<span class="hl opt">.</span>arch <span class="hl opt">=</span> Target<span class="hl opt">::</span>ARM<span class="hl opt">;</span>
    target<span class="hl opt">.</span>bits <span class="hl opt">=</span> <span class="hl num">32</span><span class="hl opt">;</span>
    std<span class="hl opt">::</span>vector<span class="hl opt">&lt;</span>Target<span class="hl opt">::</span>Feature<span class="hl opt">&gt;</span> armv7s_features<span class="hl opt">;</span>
    armv7s_features<span class="hl opt">.</span><span class="hl kwd">push_back</span><span class="hl opt">(</span>Target<span class="hl opt">::</span>ARMv7s<span class="hl opt">);</span>
    target<span class="hl opt">.</span><span class="hl kwd">set_features</span><span class="hl opt">(</span>armv7s_features<span class="hl opt">);</span>
    brighter<span class="hl opt">.</span><span class="hl kwd">compile_to_file</span><span class="hl opt">(</span><span class="hl str">&quot;lesson_11_arm_32_ios&quot;</span><span class="hl opt">,</span> args<span class="hl opt">,</span> target<span class="hl opt">);</span>


    <span class="hl slc">// Now let's check these files are what they claim, by examining</span>
    <span class="hl slc">// their first few bytes.</span>

    <span class="hl slc">// 32-arm android object files start with the magic bytes:</span>
    <span class="hl kwb">uint8_t</span> arm_32_android_magic<span class="hl opt">[] = {</span><span class="hl num">0x7f</span><span class="hl opt">,</span> <span class="hl str">'E'</span><span class="hl opt">,</span> <span class="hl str">'L'</span><span class="hl opt">,</span> <span class="hl str">'F'</span><span class="hl opt">,</span> <span class="hl slc">// ELF format</span>
                                      <span class="hl num">1</span><span class="hl opt">,</span>       <span class="hl slc">// 32-bit</span>
                                      <span class="hl num">1</span><span class="hl opt">,</span>       <span class="hl slc">// 2's complement little-endian</span>
                                      <span class="hl num">1</span><span class="hl opt">,</span>       <span class="hl slc">// Current version of elf</span>
                                      <span class="hl num">3</span><span class="hl opt">,</span>       <span class="hl slc">// Linux</span>
                                      <span class="hl num">0</span><span class="hl opt">,</span> <span class="hl num">0</span><span class="hl opt">,</span> <span class="hl num">0</span><span class="hl opt">,</span> <span class="hl num">0</span><span class="hl opt">,</span> <span class="hl num">0</span><span class="hl opt">,</span> <span class="hl num">0</span><span class="hl opt">,</span> <span class="hl num">0</span><span class="hl opt">,</span> <span class="hl num">0</span><span class="hl opt">,</span> <span class="hl slc">// 8 unused bytes</span>
                                      <span class="hl num">1</span><span class="hl opt">,</span> <span class="hl num">0</span><span class="hl opt">,</span>    <span class="hl slc">// Relocatable</span>
                                      <span class="hl num">0x28</span><span class="hl opt">,</span> <span class="hl num">0</span><span class="hl opt">};</span>  <span class="hl slc">// ARM</span>


    <span class="hl kwb">FILE</span> <span class="hl opt">*</span>f <span class="hl opt">=</span> <span class="hl kwd">fopen</span><span class="hl opt">(</span><span class="hl str">&quot;lesson_11_arm_32_android.o&quot;</span><span class="hl opt">,</span> <span class="hl str">&quot;rb&quot;</span><span class="hl opt">);</span>
    <span class="hl kwb">uint8_t</span> header<span class="hl opt">[</span><span class="hl num">32</span><span class="hl opt">];</span>
    <span class="hl kwa">if</span> <span class="hl opt">(!</span>f <span class="hl opt">||</span> <span class="hl kwd">fread</span><span class="hl opt">(</span>header<span class="hl opt">,</span> <span class="hl num">32</span><span class="hl opt">,</span> <span class="hl num">1</span><span class="hl opt">,</span> f<span class="hl opt">) !=</span> <span class="hl num">1</span><span class="hl opt">) {</span>
        <span class="hl kwd">printf</span><span class="hl opt">(</span><span class="hl str">&quot;Object file not generated</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">);</span>
        <span class="hl kwa">return</span> <span class="hl opt">-</span><span class="hl num">1</span><span class="hl opt">;</span>
    <span class="hl opt">}</span>
    <span class="hl kwd">fclose</span><span class="hl opt">(</span>f<span class="hl opt">);</span>

    <span class="hl kwa">if</span> <span class="hl opt">(</span><span class="hl kwd">memcmp</span><span class="hl opt">(</span>header<span class="hl opt">,</span> arm_32_android_magic<span class="hl opt">,</span> <span class="hl kwa">sizeof</span><span class="hl opt">(</span>arm_32_android_magic<span class="hl opt">))) {</span>
        <span class="hl kwd">printf</span><span class="hl opt">(</span><span class="hl str">&quot;Unexpected header bytes in 32-bit arm object file.</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">);</span>
        <span class="hl kwa">return</span> <span class="hl opt">-</span><span class="hl num">1</span><span class="hl opt">;</span>
    <span class="hl opt">}</span>

    <span class="hl slc">// 64-bit windows object files start with the magic 16-bit value 0x8664</span>
    <span class="hl slc">// (presumably referring to x86-64)</span>
    <span class="hl kwb">uint8_t</span> win_64_magic<span class="hl opt">[] = {</span><span class="hl num">0x64</span><span class="hl opt">,</span> <span class="hl num">0x86</span><span class="hl opt">};</span>

    f <span class="hl opt">=</span> <span class="hl kwd">fopen</span><span class="hl opt">(</span><span class="hl str">&quot;lesson_11_x86_64_windows.o&quot;</span><span class="hl opt">,</span> <span class="hl str">&quot;rb&quot;</span><span class="hl opt">);</span>
    <span class="hl kwa">if</span> <span class="hl opt">(!</span>f <span class="hl opt">||</span> <span class="hl kwd">fread</span><span class="hl opt">(</span>header<span class="hl opt">,</span> <span class="hl num">32</span><span class="hl opt">,</span> <span class="hl num">1</span><span class="hl opt">,</span> f<span class="hl opt">) !=</span> <span class="hl num">1</span><span class="hl opt">) {</span>
        <span class="hl kwd">printf</span><span class="hl opt">(</span><span class="hl str">&quot;Object file not generated</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">);</span>
        <span class="hl kwa">return</span> <span class="hl opt">-</span><span class="hl num">1</span><span class="hl opt">;</span>
    <span class="hl opt">}</span>
    <span class="hl kwd">fclose</span><span class="hl opt">(</span>f<span class="hl opt">);</span>

    <span class="hl kwa">if</span> <span class="hl opt">(</span><span class="hl kwd">memcmp</span><span class="hl opt">(</span>header<span class="hl opt">,</span> win_64_magic<span class="hl opt">,</span> <span class="hl kwa">sizeof</span><span class="hl opt">(</span>win_64_magic<span class="hl opt">))) {</span>
        <span class="hl kwd">printf</span><span class="hl opt">(</span><span class="hl str">&quot;Unexpected header bytes in 64-bit windows object file.</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">);</span>
        <span class="hl kwa">return</span> <span class="hl opt">-</span><span class="hl num">1</span><span class="hl opt">;</span>
    <span class="hl opt">}</span>

    <span class="hl slc">// 32-bit arm iOS mach-o files start with the following magic bytes:</span>
    <span class="hl kwb">uint32_t</span> arm_32_ios_magic<span class="hl opt">[] = {</span><span class="hl num">0xfeedface</span><span class="hl opt">,</span> <span class="hl slc">// Mach-o magic bytes</span>
                                   <span class="hl num">12</span><span class="hl opt">,</span>  <span class="hl slc">// CPU type is ARM</span>
                                   <span class="hl num">11</span><span class="hl opt">,</span>  <span class="hl slc">// CPU subtype is ARMv7s</span>
                                   <span class="hl num">1</span><span class="hl opt">};</span>  <span class="hl slc">// It's a relocatable object file.</span>
    f <span class="hl opt">=</span> <span class="hl kwd">fopen</span><span class="hl opt">(</span><span class="hl str">&quot;lesson_11_arm_32_ios.o&quot;</span><span class="hl opt">,</span> <span class="hl str">&quot;rb&quot;</span><span class="hl opt">);</span>
    <span class="hl kwa">if</span> <span class="hl opt">(!</span>f <span class="hl opt">||</span> <span class="hl kwd">fread</span><span class="hl opt">(</span>header<span class="hl opt">,</span> <span class="hl num">32</span><span class="hl opt">,</span> <span class="hl num">1</span><span class="hl opt">,</span> f<span class="hl opt">) !=</span> <span class="hl num">1</span><span class="hl opt">) {</span>
        <span class="hl kwd">printf</span><span class="hl opt">(</span><span class="hl str">&quot;Object file not generated</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">);</span>
        <span class="hl kwa">return</span> <span class="hl opt">-</span><span class="hl num">1</span><span class="hl opt">;</span>
    <span class="hl opt">}</span>
    <span class="hl kwd">fclose</span><span class="hl opt">(</span>f<span class="hl opt">);</span>

    <span class="hl kwa">if</span> <span class="hl opt">(</span><span class="hl kwd">memcmp</span><span class="hl opt">(</span>header<span class="hl opt">,</span> arm_32_ios_magic<span class="hl opt">,</span> <span class="hl kwa">sizeof</span><span class="hl opt">(</span>arm_32_ios_magic<span class="hl opt">))) {</span>
        <span class="hl kwd">printf</span><span class="hl opt">(</span><span class="hl str">&quot;Unexpected header bytes in 32-bit arm ios object file.</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">);</span>
        <span class="hl kwa">return</span> <span class="hl opt">-</span><span class="hl num">1</span><span class="hl opt">;</span>
    <span class="hl opt">}</span>

    <span class="hl slc">// It looks like the object files we produced are plausible for</span>
    <span class="hl slc">// those targets. We'll count that as a success for the purposes</span>
    <span class="hl slc">// of this tutorial. For a real application you'd then need to</span>
    <span class="hl slc">// figure out how to integrate Halide into your cross-compilation</span>
    <span class="hl slc">// toolchain. There are several small examples of this in the</span>
    <span class="hl slc">// Halide repository under the apps folder. See HelloAndroid and</span>
    <span class="hl slc">// HelloiOS here:</span>
    <span class="hl slc">// https://github.com/halide/Halide/tree/master/apps/</span>
    <span class="hl kwd">printf</span><span class="hl opt">(</span><span class="hl str">&quot;Success!</span><span class="hl esc">\n</span><span class="hl str">&quot;</span><span class="hl opt">);</span>
    <span class="hl kwa">return</span> <span class="hl num">0</span><span class="hl opt">;</span>
<span class="hl opt">}</span>
</pre>
</div>
</body>
</html>
